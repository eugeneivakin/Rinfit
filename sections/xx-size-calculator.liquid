{{ 'xx-size-calculator.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-calculator{
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
  }
{%- endstyle -%}

<section class="section-calculator">
  <div class="calculator">
    {% if section.settings.main_title != blank %}
      <h2 class="main-title-calculator">{{ section.settings.main_title }}</h2>
    {% endif %}
    <div class="main-container-calculator">
      <div class="main-container-select-label">
        <div>
          <div class="main-label-calculator">Units of measurement:</div>
          <div class="main-container-calculator-top">
            <select class="main-select-calculator" id="unit">
              <option value="mm">Millimeters (mm)</option>
              <option value="inch">Inches (inch)</option>
            </select>
            <span class="select-icon-calculator">
              {{ 'xx-ChevronDownIcon.svg' | asset_url | img_tag }}
            </span>
          </div>
        </div>
        <div>
          <div class="main-label-calculator">Measurement type:</div>
          <div class="main-container-calculator-top">
            <select class="main-select-calculator" id="type">
              <option value="diameter">Diameter</option>
              <option value="circumference">Circumference</option>
            </select>
            <span class="select-icon-calculator">
              {{ 'xx-ChevronDownIcon.svg' | asset_url | img_tag }}
            </span>
          </div>
        </div>
      </div>

      <div class="main-label-calculator">Enter the value:</div>
      <input class="main-input-calculator" type="number" id="value" placeholder="For example: 18.1" step="any">
      <button class="main-button-calculator" onclick="calculateSize()">Calculate</button>
      <div class="result" id="result">The result will appear here.</div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const selectBlocks = document.querySelectorAll('.main-container-calculator-top');

    selectBlocks.forEach((block) => {
      const select = block.querySelector('.main-select-calculator');
      const icon = block.querySelector('.select-icon-calculator');

      select.addEventListener('mousedown', () => {
        icon.classList.toggle('open');
      });

      select.addEventListener('blur', () => {
        icon.classList.remove('open');
      });
    });
  });
</script>
<script>
  const ringData = [
      {% for item in shop.metaobjects.size_ring.values %}
          {
              size: {{ item.size }},
              dia_mm: {{ item.diameter_mm }},
              dia_in: {{ item.diameter_inches }},
              cir_mm: {{ item.circumference_mm }},
              cir_in: {{ item.circumference_inches }}
          }{% unless forloop.last %},{% endunless %}
      {% endfor %}
  ];
</script>

<script>
  function calculateSize() {
    const unit = document.getElementById('unit').value;
    const type = document.getElementById('type').value;
    const value = parseFloat(document.getElementById('value').value);
    const resultDiv = document.getElementById('result');

    if (isNaN(value)) {
      resultDiv.textContent = 'Please enter a number.';
      return;
    }

    const key = type === 'diameter' ? (unit === 'mm' ? 'dia_mm' : 'dia_in') : unit === 'mm' ? 'cir_mm' : 'cir_in';

    let closest = null;
    let minDiff = Infinity;

    ringData.forEach((r) => {
      const diff = Math.abs(r[key] - value);
      if (diff < minDiff) {
        minDiff = diff;
        closest = r;
      }
    });

    if (closest) {
      resultDiv.innerHTML = `
            <b>Ring size: ${closest.size}</b><br>
            Diameter: ${closest.dia_mm} мм (${closest.dia_in} inches)<br>
            Circumference: ${closest.cir_mm} мм (${closest.cir_in} inches)
        `;
    } else {
      resultDiv.innerHTML = `
            Size not found, please check the measurement table and try again.
        `;
    }
  }
</script>

{% schema %}
{
  "name": "Size calculator",
  "settings": [
    {
      "type": "richtext",
      "id": "main_title",
      "label": "Title"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding top",
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding bottom",
      "default": 40
    }
  ],
  "presets": [
    {
      "name": "Size calculator"
    }
  ]
}
{% endschema %}
