<!-- SHOPIFY CHAT BOT - –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ö–û–î -->
<!-- –í—Å—Ç–∞–≤—å —ç—Ç–æ—Ç –∫–æ–¥ –≤ Shopify Admin ‚Üí Themes ‚Üí Edit Code ‚Üí theme.liquid –ø–µ—Ä–µ–¥ </body> -->

<style>
/* ============================================ */
/* –°–£–ü–ï–† –£–ù–ò–ö–ê–õ–¨–ù–´–ï –°–¢–ò–õ–ò - –ù–ï –ö–û–ù–§–õ–ò–ö–¢–£–Æ–¢ */
/* ============================================ */
#chatbot-widget-main-container-2025 { position: fixed !important; bottom: 20px !important; right: 20px !important; z-index: 999999 !important; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif !important; }
#chatbot-floating-button-2025 { width: 60px !important; height: 60px !important; border-radius: 50% !important; background: #1c1c1c !important; border: none !important; cursor: pointer !important; box-shadow: 0 4px 20px rgba(0,0,0,0.3) !important; display: flex !important; align-items: center !important; justify-content: center !important; font-size: 28px !important; transition: transform 0.3s !important; }
#chatbot-floating-button-2025:hover { transform: scale(1.1) !important; }
#chatbot-main-window-2025 { display: none !important; position: fixed !important; bottom: 90px !important; right: 20px !important; width: 440px !important; height: 600px !important; background: white !important; border-radius: 16px !important; box-shadow: 0 8px 40px rgba(0,0,0,0.2) !important; flex-direction: column !important; overflow: hidden !important; }
#chatbot-main-window-2025.chatbot-active-state-2025 { display: flex !important; animation: chatbotSlideUp2025 0.3s ease !important; }
@keyframes chatbotSlideUp2025 { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
#chatbot-header-section-2025 { background: #1c1c1c !important; color: white !important; padding: 16px 20px !important; display: flex !important; justify-content: space-between !important; align-items: center !important; }
#chatbot-header-section-2025 h3 { margin: 0 !important; font-size: 18px !important; font-weight: 600 !important; }
.chatbot-status-indicator-2025 { font-size: 12px !important; opacity: 0.9 !important; margin-top: 2px !important; }
#chatbot-close-button-2025 { background: rgba(255,255,255,0.2) !important; border: none !important; color: white !important; width: 32px !important; height: 32px !important; border-radius: 50% !important; cursor: pointer !important; font-size: 20px !important; display: flex !important; align-items: center !important; justify-content: center !important; }
#chatbot-close-button-2025:hover { background: rgba(255,255,255,0.3) !important; }
#chatbot-messages-container-2025 { flex: 1 !important; padding: 20px !important; overflow-y: auto !important; background: #efefef !important; }
.chatbot-message-item-2025 { margin-bottom: 16px !important; display: flex !important; align-items: flex-start !important; gap: 10px !important; animation: chatbotMessageIn2025 0.3s ease !important; }
@keyframes chatbotMessageIn2025 { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
.chatbot-message-avatar-2025 { width: 36px !important; height: 36px !important; border-radius: 50% !important; background: #ffffff !important; border: 2px solid #1c1c1c !important; display: flex !important; align-items: center !important; justify-content: center !important; font-size: 18px !important; flex-shrink: 0 !important; }
.chatbot-user-message-2025 { flex-direction: row-reverse !important; }
.chatbot-user-message-2025 .chatbot-message-avatar-2025 { background: #1c1c1c !important; border: 2px solid #1c1c1c !important; }
.chatbot-message-content-box-2025 { background: white !important; padding: 12px 16px !important; border-radius: 12px !important; max-width: 70% !important; box-shadow: 0 2px 8px rgba(0,0,0,0.05) !important; word-wrap: break-word !important; }
.chatbot-user-message-2025 .chatbot-message-content-box-2025 { background: #1c1c1c !important; color: white !important; }
#chatbot-input-section-2025 { padding: 16px !important; background: white !important; border-top: 1px solid #e0e0e0 !important; display: flex !important; gap: 10px !important; }
#chatbot-text-input-2025 { flex: 1 !important; padding: 12px 16px !important; border: 1px solid #e0e0e0 !important; border-radius: 24px !important; font-size: 14px !important; outline: none !important; }
#chatbot-text-input-2025:focus { border-color: #1c1c1c !important; }
#chatbot-send-button-2025 { background: #1c1c1c !important; color: white !important; border: none !important; width: 44px !important; height: 44px !important; border-radius: 50% !important; cursor: pointer !important; display: flex !important; align-items: center !important; justify-content: center !important; font-size: 18px !important; }
#chatbot-send-button-2025:hover { opacity: 0.9 !important; }
.chatbot-products-list-2025 { display: flex !important; flex-direction: column !important; gap: 12px !important; margin-top: 15px !important; }
.chatbot-product-card-2025 { border: 1px solid #e0e0e0 !important; border-radius: 12px !important; padding: 12px !important; display: flex !important; flex-direction: column !important; gap: 0 !important; background: white !important; transition: all 0.3s !important; position: relative !important; }
.chatbot-product-card-2025:hover { box-shadow: 0 4px 12px rgba(28,28,28,0.15) !important; transform: translateY(-2px) !important; }
.chatbot-product-card-out-stock-2025 { opacity: 0.6 !important; background: #f5f5f5 !important; }
.chatbot-product-image-2025 { width: 60px !important; height: 60px !important; object-fit: cover !important; border-radius: 8px !important; flex-shrink: 0 !important; }
.chatbot-product-info-2025 { flex: 1 !important; display: flex !important; flex-direction: column !important; justify-content: space-between !important; min-width: 0 !important; }
.chatbot-product-title-2025 { font-weight: 600 !important; font-size: 12px !important; color: #333 !important; margin-bottom: 4px !important; line-height: 1.3 !important; overflow: hidden !important; display: -webkit-box !important; -webkit-line-clamp: 2 !important; -webkit-box-orient: vertical !important; }
.chatbot-product-price-box-2025 { display: flex !important; align-items: center !important; gap: 8px !important; }
.chatbot-price-current-2025 { color: #1c1c1c !important; font-weight: 700 !important; font-size: 16px !important; }
.chatbot-price-old-2025 { color: #999 !important; font-size: 13px !important; text-decoration: line-through !important; }
.chatbot-stock-status-2025 { font-size: 11px !important; color: #27ae60 !important; margin-top: 2px !important; }
.chatbot-stock-status-out-2025 { color: #e74c3c !important; }
.chatbot-product-actions-2025 { display: flex !important; flex-direction: column !important; gap: 8px !important; width: 100% !important; }
.chatbot-btn-add-cart-2025 { background: #1c1c1c !important; color: white !important; border: none !important; padding: 12px !important; width: 100% !important; border-radius: 8px !important; font-size: 14px !important; font-weight: 600 !important; cursor: pointer !important; transition: all 0.3s !important; }
.chatbot-btn-add-cart-2025:hover { background: #333 !important; }
.chatbot-btn-add-cart-2025:disabled { background: #ccc !important; cursor: not-allowed !important; }
.chatbot-btn-view-2025 { background: white !important; color: #1c1c1c !important; border: 1px solid #e0e0e0 !important; padding: 8px !important; width: 100% !important; border-radius: 8px !important; font-size: 14px !important; font-weight: 500 !important; cursor: pointer !important; transition: all 0.3s !important; }
.chatbot-btn-view-2025:hover { background: #efefef !important; border-color: #1c1c1c !important; }
.chatbot-cart-notification-2025 { position: fixed !important; top: 20px !important; right: 20px !important; background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%) !important; color: white !important; padding: 16px 24px !important; border-radius: 12px !important; box-shadow: 0 4px 20px rgba(0,0,0,0.2) !important; z-index: 999999 !important; animation: chatbotSlideIn2025 0.3s ease !important; display: flex !important; align-items: center !important; gap: 12px !important; }
@keyframes chatbotSlideIn2025 { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
.chatbot-discount-badge-2025 { display: inline-block !important; background: #e74c3c !important; color: white !important; padding: 3px 6px !important; border-radius: 4px !important; font-size: 11px !important; font-weight: 700 !important; margin-left: 6px !important; }
.chatbot-typing-indicator-2025 { display: flex !important; gap: 4px !important; padding: 12px 16px !important; }
.chatbot-typing-indicator-2025 span { width: 8px !important; height: 8px !important; border-radius: 50% !important; background: #1c1c1c !important; animation: chatbotTyping2025 1.4s infinite !important; }
.chatbot-typing-indicator-2025 span:nth-child(2) { animation-delay: 0.2s !important; }
.chatbot-typing-indicator-2025 span:nth-child(3) { animation-delay: 0.4s !important; }
@keyframes chatbotTyping2025 { 0%, 60%, 100% { transform: translateY(0); opacity: 0.7; } 30% { transform: translateY(-10px); opacity: 1; } }
@media (max-width: 768px) {
  #chatbot-main-window-2025 { width: 100vw !important; height: 100vh !important; bottom: 0 !important; right: 0 !important; border-radius: 0 !important; }
  #chatbot-widget-main-container-2025 { bottom: 0 !important; right: 0 !important; }
}
</style>

<div id="chatbot-widget-main-container-2025">
  <button id="chatbot-floating-button-2025" onclick="chatbotToggleWindow2025()">üí¨</button>

  <div id="chatbot-main-window-2025">
    <div id="chatbot-header-section-2025">
      <div>
        <h3>–ü–æ–º–æ—â–Ω–∏–∫ –º–∞–≥–∞–∑–∏–Ω–∞</h3>
        <div class="chatbot-status-indicator-2025">üü¢ –û–Ω–ª–∞–π–Ω</div>
      </div>
      <button id="chatbot-close-button-2025" onclick="chatbotToggleWindow2025()">√ó</button>
    </div>

    <div id="chatbot-messages-container-2025">
      <div class="chatbot-message-item-2025 chatbot-bot-message-2025">
        <div class="chatbot-message-avatar-2025">ü§ñ</div>
        <div class="chatbot-message-content-box-2025">
          –ü—Ä–∏–≤–µ—Ç! –Ø –≤–∞—à –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?
        </div>
      </div>
    </div>

    <div id="chatbot-input-section-2025">
      <input type="text" id="chatbot-text-input-2025" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="if(event.key==='Enter') chatbotSendMessage2025()">
      <button id="chatbot-send-button-2025" onclick="chatbotSendMessage2025()">‚û§</button>
    </div>
  </div>
</div>

<script>
(function() {
  'use strict';

  // ============================================
  // –ù–ê–°–¢–†–û–ô–ö–ò - –ò–ó–ú–ï–ù–ò –¢–û–õ–¨–ö–û –≠–¢–£ –°–¢–†–û–ö–£!
  // ============================================
  const CHATBOT_WEBHOOK_URL_2025 = 'https://rwee.app.n8n.cloud/webhook/shopify-chat-working';

  // ============================================
  // –ö–û–î - –ù–ï –¢–†–û–ì–ê–ô –ù–ò–ñ–ï
  // ============================================
  const chatbotWindow = document.getElementById('chatbot-main-window-2025');
  const chatbotButton = document.getElementById('chatbot-floating-button-2025');
  const chatbotMessagesContainer = document.getElementById('chatbot-messages-container-2025');
  const chatbotMessageInput = document.getElementById('chatbot-text-input-2025');

  let chatbotSessionId2025 = 'session_' + Date.now();
  let chatbotConversationHistory2025 = [];

  window.chatbotToggleWindow2025 = function() {
    chatbotWindow.classList.toggle('chatbot-active-state-2025');
    if (chatbotWindow.classList.contains('chatbot-active-state-2025')) {
      chatbotMessageInput.focus();
    }
  };

  function chatbotDisplayMessage2025(text, isUser, data) {
    const messageDiv = document.createElement('div');
    messageDiv.className = 'chatbot-message-item-2025 ' + (isUser ? 'chatbot-user-message-2025' : 'chatbot-bot-message-2025');

    if (isUser) {
      messageDiv.innerHTML = `
        <div class="chatbot-message-avatar-2025">üë§</div>
        <div class="chatbot-message-content-box-2025">${text}</div>
      `;
    } else {
      const avatarDiv = document.createElement('div');
      avatarDiv.className = 'chatbot-message-avatar-2025';
      avatarDiv.textContent = 'ü§ñ';
      messageDiv.appendChild(avatarDiv);

      const contentDiv = document.createElement('div');
      contentDiv.className = 'chatbot-message-content-box-2025';
      contentDiv.innerHTML = text.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
      messageDiv.appendChild(contentDiv);

      if (data && data.products && data.products.length > 0) {
        const productsContainer = document.createElement('div');
        productsContainer.className = 'chatbot-products-list-2025';

        data.products.forEach(function(product) {
          const card = chatbotCreateProductCard2025(product);
          productsContainer.appendChild(card);
        });

        contentDiv.appendChild(productsContainer);
      }
    }

    chatbotMessagesContainer.appendChild(messageDiv);
    chatbotMessagesContainer.scrollTop = chatbotMessagesContainer.scrollHeight;
  }

  function chatbotCreateProductCard2025(product) {
    const card = document.createElement('div');
    card.className = 'chatbot-product-card-2025 ' + (!product.inStock ? 'chatbot-product-card-out-stock-2025' : '');

    let discountPercent = 0;
    if (product.comparePrice && product.comparePrice > product.price) {
      discountPercent = Math.round(((product.comparePrice - product.price) / product.comparePrice) * 100);
    }

    // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º –∫–∞–≤—ã—á–∫–∏ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    const safeTitle = (product.title || '').replace(/'/g, '&#39;').replace(/"/g, '&quot;');

    card.innerHTML = `
      <div style="display: flex; gap: 12px; margin-bottom: 12px;">
        <img src="${product.image || 'https://via.placeholder.com/60'}"
             class="chatbot-product-image-2025"
             alt="${safeTitle}">
        <div class="chatbot-product-info-2025">
          <div class="chatbot-product-title-2025">${safeTitle}</div>
          <div class="chatbot-product-price-box-2025">
            <span class="chatbot-price-current-2025">$${product.price}</span>
            ${product.comparePrice && product.comparePrice > product.price ?
              '<span class="chatbot-price-old-2025">$' + product.comparePrice + '</span>' : ''}
            ${discountPercent > 0 ? '<span class="chatbot-discount-badge-2025">-' + discountPercent + '%</span>' : ''}
          </div>
          <div class="chatbot-stock-status-2025 ${!product.inStock ? 'chatbot-stock-status-out-2025' : ''}">
            ${product.inStock ? '‚úÖ –í –Ω–∞–ª–∏—á–∏–∏' : '‚ùå –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
          </div>
        </div>
      </div>
      <div class="chatbot-product-actions-2025">
        <button class="chatbot-btn-view-2025"
                onclick="window.location.href='${product.productUrl}'">
          –°–º–æ—Ç—Ä–µ—Ç—å
        </button>
      </div>
    `;

    return card;
  }

  window.chatbotAddToCart2025 = function(cartUrl, productTitle) {
    chatbotShowCartNotification2025(productTitle);
    window.open(cartUrl, '_blank');
  };

  function chatbotShowCartNotification2025(productTitle) {
    const notification = document.createElement('div');
    notification.className = 'chatbot-cart-notification-2025';
    notification.innerHTML = `
      <span style="font-size: 24px;">‚úÖ</span>
      <div>
        <div style="font-weight: 700; margin-bottom: 4px;">–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É!</div>
        <div style="font-size: 13px; opacity: 0.9;">${productTitle}</div>
      </div>
    `;

    document.body.appendChild(notification);

    setTimeout(function() {
      notification.style.animation = 'chatbotSlideIn2025 0.3s ease reverse';
      setTimeout(function() {
        if (notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 300);
    }, 3000);
  }

  window.chatbotSendMessage2025 = async function() {
    const message = chatbotMessageInput.value.trim();
    if (!message) return;

    chatbotDisplayMessage2025(message, true);
    chatbotMessageInput.value = '';

    chatbotShowTypingIndicator2025();

    chatbotConversationHistory2025.push({
      role: 'user',
      content: message
    });

    try {
      const response = await fetch(CHATBOT_WEBHOOK_URL_2025, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          message: message,
          sessionId: chatbotSessionId2025,
          conversationHistory: chatbotConversationHistory2025.slice(-10),
          shopInfo: {
            domain: window.location.hostname,
            currency: 'USD',
            locale: 'ru'
          },
          pageContext: {
            url: window.location.href,
            path: window.location.pathname
          }
        })
      });

      const data = await response.json();

      chatbotHideTypingIndicator2025();

      if (data.success) {
        chatbotDisplayMessage2025(data.reply, false, data);

        chatbotConversationHistory2025.push({
          role: 'assistant',
          content: data.reply
        });
      } else {
        chatbotDisplayMessage2025('–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.', false);
      }

    } catch (error) {
      chatbotHideTypingIndicator2025();
      console.error('Chatbot Error:', error);
      chatbotDisplayMessage2025('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.', false);
    }
  };

  function chatbotShowTypingIndicator2025() {
    const indicator = document.createElement('div');
    indicator.className = 'chatbot-message-item-2025 chatbot-bot-message-2025 chatbot-typing-indicator-2025';
    indicator.id = 'chatbot-typing-indicator-2025';
    indicator.innerHTML = '<span></span><span></span><span></span>';
    chatbotMessagesContainer.appendChild(indicator);
    chatbotMessagesContainer.scrollTop = chatbotMessagesContainer.scrollHeight;
  }

  function chatbotHideTypingIndicator2025() {
    const indicator = document.getElementById('chatbot-typing-indicator-2025');
    if (indicator && indicator.parentNode) {
      indicator.parentNode.removeChild(indicator);
    }
  }
})();
</script>
